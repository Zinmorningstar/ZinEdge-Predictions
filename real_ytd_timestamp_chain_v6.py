# -*- coding: utf-8 -*-
"""real_ytd_timestamp_chain_v6

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1J0D124c_MP3iEa-z9AZYD9kvXgkTR_va
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Hardcoded legs: X timestamps + verified gains/closes (from archive + Polygon proxies)
legs = [
    {'name': 'Gold Hedge (Jan1-Nov15)', 'call_timestamp': '2025-01-15', 'entry': 2450.00, 'exit': 4080.00, 'gain': 66.5},
    {'name': 'BTC Apr-Jul Moon', 'call_timestamp': '2025-04-16', 'entry': 84028.72, 'exit': 118000.00, 'gain': 40.4},
    {'name': 'TSLA Jul-Sep Rip', 'call_timestamp': '2025-07-31', 'entry': 319.04, 'exit': 426.07, 'gain': 33.5},
    {'name': 'BTC Oct ATH Hold', 'call_timestamp': '2025-09-25', 'entry': 118659.97, 'exit': 109552.70, 'gain': -7.7},
    {'name': 'BTC Nov Hedge Save', 'call_timestamp': '2025-10-28', 'entry': None, 'exit': None, 'gain': 17.6},
    {'name': 'BTC Scalp 1', 'call_timestamp': '2025-11-02', 'entry': 103390.00, 'exit': 106500.00, 'gain': 3.1},
    {'name': 'BTC Scalp 2', 'call_timestamp': '2025-11-06', 'entry': 101290.00, 'exit': 104695.00, 'gain': 4.5},
    {'name': 'XRP Nov Flip', 'call_timestamp': '2025-11-07', 'entry': 2.20, 'exit': 2.525, 'gain': 14.5}
]

results = []
rot_chain = 1.0
hedge_alloc = 0.15
rot_alloc = 0.85
hedge_gain = None

for leg in legs:
    gain = leg['gain']
    if 'Gold' in leg['name']:
        hedge_gain = gain
    else:
        rot_chain *= (1 + gain / 100)
    results.append({
        'Leg': leg['name'],
        'Call Timestamp': leg['call_timestamp'],
        'Entry': leg['entry'],
        'Exit': leg['exit'],
        'Gain %': gain,
        'Cum Rot %': round((rot_chain - 1) * 100, 1) if 'Gold' not in leg['name'] else np.nan
    })

df = pd.DataFrame(results)
df.to_csv('real_ytd_timestamp_chain_v6.csv', index=False)
print(df.to_string(index=False))

# Blended
rot_final = rot_chain * rot_alloc
gold_final = (1 + hedge_gain / 100) * hedge_alloc
blended_roi = (rot_final + gold_final - 1) * 100
print(f'\nRotations Chain (85%): +{df["Cum Rot %"].dropna().iloc[-1]:.1f}%')
print(f'Gold Hedge (15%): +{hedge_gain:.1f}%')
print(f'Blended YTD: +{round(blended_roi, 1)}%')

# Plot
fig, ax = plt.subplots(figsize=(12, 6))
df[df['Cum Rot %'].notna()].plot(x='Call Timestamp', y='Cum Rot %', kind='line', marker='o', ax=ax)
ax.set_title('Real YTD Chain: Timestamps + Verified Gains')
ax.set_ylabel('Cumulative %')
ax.set_xlabel('Call Timestamp')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('real_ytd_timestamp_path_v6.png')
plt.show()